<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<title>Sending Mail</title>
<link href="../../../css/basic.css" rel="stylesheet" type="text/css">
<script type="text/javascript" language="JavaScript">
<!--
function putSemester() {
    var today=new Date();
    var thisMonth=today.getMonth()+1;
    var thisYear=today.getFullYear();
    if(thisMonth <=6) {
        return "Spring, " + thisYear;
    }
    else {
       return "Fall, " + thisYear;
    }
}//-->
</script>
<style type="text/css">
<!--
    .bgStripes {
        background-image:url(../../../images/Xstripes.gif);
        background-attachment: fixed;
    }
    body {
        background-color:white;
    }
    strong {
        font-family: Arial, Helvetica, sans-serif;
    }
-->
</style>
</head>
<body style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<table class="bgStripes" border="0" width="100%">
<tbody>
<tr name="firstRow">
<td valign="top" width="80"><span style="font-size: x-small; font-weight: bold;">
<script type="text/javascript">
<!--
    document.write(putSemester());
-->
</script>
</span> <br>
</td>
<td style="text-align: center;"><span style="font-weight: bold; font-size: medium; color: darkblue;">
PHP Web Development with MySQL
</span> </td>
<td align="right" valign="top" width="80"><span style="font-size: x-small; font-weight: bold;">
3 Credits</span> </td>
</tr>
<tr>
<td colspan="3" style="text-align: center;"><span style="font-size: xx-small; font-weight: bold;">
152-166</span> </td>
</tr>
</tbody>
</table>
<!--The heading for the slides --> <br>
<table class="headTable1" border="0">
<tbody>
<tr>
<td width="100"><a href="date.html"><img alt="" src="../../../images/btn_lArrow.gif" border="0"></a><a href="index.html"><img alt="" src="../../../images/btn_upArrow.gif" border="0"></a><a href="index.html"><img alt="" src="../../../images/btn_rArrow.gif" border="0"></a></td>
<td>Sending Mail</td>
</tr>
</tbody>
</table>
<br>
<div class="disp1">
<ul class="slidesUl1">
<li><p>
For a PHP script to be able to send e-mail, it must be able to talk to a mail
server that is willing to accept its request and deliver the e-mail to the Internet.
</p><p>
A mail server, sometimes referred to as the Simple Mail Transfer Protocol (SMTP) server,
is a software process that takes an e-mail message for delivery and forwards it
to other mail servers on the Internet until the message reaches its final destination.
</p><p>
To set up PHP to talk to your mail server, first you must know the IP or the
Internet address of your mail server.
</p><p>
Typically, your local Internet Service Provider (ISP) will provide this information
to you. The mail server for SBC DSL, for example, is:
</p>
<blockquote><code>
mail.sbcglobal.net<br>
</code></blockquote>
<p>
Next, you need to update the SMTP property in the php.ini file to point to this server.
</p><p>
The default value of this property is localhost because all UNIX-based machines
already have a mail server installed locally at IP address 127.0.0.1.
Windows, on the other hand, does not have a local mail server set up by default.
</p><p>
In the past, any mail server would accept a request to deliver any message by
anyone to anyone. However, because spammers abused this loophole, almost all
mail servers are protected now, the most common protection being a mail server,
provided by an ISP, that will only accept messages originating from its own network.
</p><p>
Some ISPs require that the mail server request a login and password. If this is
the case, you can use the mail function provided by the PHP Extension and
Application Library (PEAR).
</p><p>
PEAR's Mail package defines an interface and functions for sending e-mail.
See: <a href="http://pear.php.net/package/Mail">http://pear.php.net/package/Mail</a>
</p><p>
You always have the option of setting up your own mail server to take delivery
requests, a topic beyond the scope of this course.
</p></li>
<li><p>
MIME (Multipurpose Internet Mail Extensions)
</p><p>
MIME, as the name implies was an extension to the e-mail standard protocol for
sending e-mail messages. In the early days of the Internet, e-mail messages
consisted of plain text.
</p><p>
The extension allowed e-mail content to contain HTML tags embedded in the
message text, images, links, graphics, and logos, as well as e-mail attachments.
Most e-mail messages sent today use MIME.
</p><p>
An e-mail containing different types of content, such as HTML text and images,
is called a multipart MIME message. When setting up this type of e-mail, the
content type and encoding type is sent in MIME headers as you will see in the
following examples.
</p></li>
<li><p>
Runtime Configuration Options
</p><p>
The following list describes all e-mail–related properties in the php.ini
configuration file.
</p>
<h4>
SMTP (Simple Mail Transfer Protocol)</h4>
<p>
This is the main property for e-mail. It specifies where the server is that
will accept and deliver the messages sent from a PHP program.
</p><p>
By default it is set to localhost, which will work on most UNIX-based systems,
but can be configured to point to your local ISP's mail server.
</p>
<h4>
smtp_port</h4>
<p>
The SMTP port is, in most cases, port 25, the default value. The SMTP standard
specifies that all SMTP servers must use port 25 for incoming mail.
</p><p>
In most situations, you should not change this property or you might not be able
to receive incoming mail from the Internet.
</p>
<h4>
sendmail_from</h4>
<p>
If you are relying on <b>sendmail</b> , a local program on UNIX-based systems
to deliver e-mail, you can specify your default "From" value for your messages
in this field. By default it is empty.
</p>
<h4>
sendmail_path</h4>
<p>
This property is used to set up the path to the local sendmail program.
It is typically a path such as:</p>
<blockquote><code>
/usr/sbin/sendmail<br>
</code></blockquote>
<p>
or
</p>
<blockquote><code>
/usr/lib/sendmail<br>
</code></blockquote>
<p>
on UNIX systems.
</p></li>
<li><p>
The mail() Function
</p><p>
The built-in PHP <b>mail()</b> function makes sending e-mail quite simple.
It uses the following format.
</p><p>
Format:
</p>
<code><small>
bool mail ( string to, string subject, string message [,<br>
&nbsp;&nbsp;&nbsp;&nbsp;string additional_headers [, string additional_parameters]] )<br>
</small></code>
<p>
Example:
</p>
<code><small>
mail('joe@joesite.com','Contact Us Form','This is an email from your site',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'From: marko@markosite.com"');<br>
</small></code>
<p>
The mail() function returns TRUE if the message was delivered to the mail server
successfully, FALSE otherwise.
</p><p>
The arguments can be broken down as follows:
</p><p>
<b>to</b> :
The reciever(s). If multiple, then comma-separated. Must be in format such as:
</p>
<blockquote><code><small>
user@example.com<br><br>
user@example.com, anotheruser@example.com<br><br>
User &lt;user@example.com&gt;<br><br>
User &lt;user@example.com&gt;, Another User &lt;anotheruser@example.com&gt;
</small></code></blockquote>
<p>
<b>subject</b> :	Subject of the message.
</p><p>
<b>message</b> :	The actual text of the message.
</p><p>
<b>additional_headers</b> (optional) :
If specified, it will be passed in the header of the message.
Might alter the behavior of the reader when rendering the message
(such as when using HTML in the message).
</p><p>
<b>additional_parameters</b> (optional) :
Used to pass additional parameters to the mail server.
The use of this feature heavily depends on the particular mail server version.
</p></li>
<li><p>
Sending a Simple E-Mail Message
</p><p>
In the following example, PHP sends a simple e-mail message. In this example,
the data is supplied, but you might want to use an HTML form to submit the
information from a Web page, validate the form fields, and then send e-mail
based on user input.
</p>
<h4>
Filename: mail.php
</h4>
<blockquote><small>
<div class="disp2">
<PRE>
<span class="syntax0"><span class="gutter">   1:</span><span class="syntax17">&lt;?php</span>
<span class="gutter">   2:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">send</span><span class="syntax2"> </span><span class="syntax2">an</span><span class="syntax2"> </span><span class="syntax2">email</span><span class="syntax2"> </span><span class="syntax2">with</span><span class="syntax2"> </span><span class="syntax2">hard-coded</span><span class="syntax2"> </span><span class="syntax2">data</span><span class="syntax2"> </span>
<span class="gutter">   3:</span>  <span class="syntax10">$Recipient</span> <span class="syntax18">=</span> <span class="syntax13">'</span><span class="syntax13">djefferson@gmail.com</span><span class="syntax13">'</span><span class="syntax18">;</span>
<span class="gutter">   4:</span>  <span class="syntax10">$MsgSubject</span> <span class="syntax18">=</span> <span class="syntax13">'</span><span class="syntax13">Hello</span><span class="syntax13"> </span><span class="syntax13">from</span><span class="syntax13"> </span><span class="syntax13">Yahoo!</span><span class="syntax13">'</span><span class="syntax18">;</span>
<span class="gutterH">   5:</span>
<span class="gutter">   6:</span>   <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">You</span><span class="syntax2"> </span><span class="syntax2">must</span><span class="syntax2"> </span><span class="syntax2">set</span><span class="syntax2"> </span><span class="syntax2">sender</span><span class="syntax2"> </span><span class="syntax2">through</span><span class="syntax2"> </span><span class="syntax2">message</span><span class="syntax2"> </span><span class="syntax2">header</span>
<span class="gutter">   7:</span>  <span class="syntax10">$MsgHeader</span> <span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">From</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">D</span><span class="syntax14">.</span><span class="syntax14">W</span><span class="syntax14">.</span><span class="syntax14"> </span><span class="syntax14">Jefferson</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">jefferson_dw</span><span class="syntax14">@</span><span class="syntax14">yahoo</span><span class="syntax14">.</span><span class="syntax14">com</span><span class="syntax14">&gt;</span><span class="syntax14">\r\n</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutter">   8:</span>  <span class="syntax10">$MsgBody</span> <span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">This</span><span class="syntax14"> </span><span class="syntax14">is</span><span class="syntax14"> </span><span class="syntax14">a</span><span class="syntax14"> </span><span class="syntax14">simple</span><span class="syntax14">,</span><span class="syntax14"> </span><span class="syntax14">2</span><span class="syntax14"> </span><span class="syntax14">line</span><span class="syntax14"> </span><span class="syntax14">message\r\nLine</span><span class="syntax14"> </span><span class="syntax14">2</span><span class="syntax14"> </span><span class="syntax14">of</span><span class="syntax14"> </span><span class="syntax14">message</span><span class="syntax14">.</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutter">   9:</span>  
<span class="gutterH">  10:</span>  <span class="syntax10">$success</span> <span class="syntax18">=</span> <span class="syntax9">mail</span><span class="syntax18">(</span><span class="syntax10">$Recipient</span><span class="syntax18">,</span> <span class="syntax10">$MsgSubject</span><span class="syntax18">,</span> <span class="syntax10">$MsgBody</span><span class="syntax18">,</span> <span class="syntax10">$MsgHeader</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="gutter">  11:</span>  <span class="syntax8">if</span><span class="syntax18"> (</span><span class="syntax10">$success</span><span class="syntax18">)</span>
<span class="gutter">  12:</span>    <span class="syntax8">echo</span> <span class="syntax13">'</span><span class="syntax13">Email</span><span class="syntax13"> </span><span class="syntax13">message</span><span class="syntax13"> </span><span class="syntax13">sent</span><span class="syntax13"> </span><span class="syntax13">to:</span><span class="syntax13"> </span><span class="syntax13">'</span><span class="syntax18">,</span> <span class="syntax10">$Recipient</span><span class="syntax18">;</span>
<span class="gutter">  13:</span>  <span class="syntax8">else</span>
<span class="gutter">  14:</span>    <span class="syntax8">echo</span> <span class="syntax13">'</span><span class="syntax13">Failed</span><span class="syntax13"> </span><span class="syntax13">to</span><span class="syntax13"> </span><span class="syntax13">send</span><span class="syntax13"> </span><span class="syntax13">email</span><span class="syntax13"> </span><span class="syntax13">message</span><span class="syntax13"> </span><span class="syntax13">to:</span><span class="syntax13"> </span><span class="syntax13">'</span><span class="syntax18">,</span> <span class="syntax10">$Recipient</span><span class="syntax18">;</span>
<span class="gutterH">  15:</span><span class="syntax17">?&gt;</span></span>
</PRE>
</div>
</small></blockquote>
<p>
The <b>mail()</b> function on line 10 causes the e-mail to be sent.
For this to work, you must have an SMTP server available to you and have the
php.ini file properly configured, or use the local sendmail daemon on Unix or Linux.
</p><p>
Your instructor will show you the email received by successful execution of a
script similar to this. Notice that the Subject, From, and To fields correspond
to the values entered in the PHP script.
</p></li>
<li><p>
Example: Sending an HTML Message
</p><p>
Sending an HTML message is very similar to sending a plain text message.
The advantage of sending an HTML e-mail message is that you can gain greater
control over the presentation of the message by including hyperlinks, images,
tables, colors, fonts, and so on.
</p><p>
The important difference between sending plain text and HMTL text is in the
message header.
</p><p>
Headers are meta-information passed to the mail server to tell
it how to treat the message; for example, what type of content is being sent,
or which encoding is used.
</p><p>
These headers are similar to the HTML headers used to redirect the user to
another Web site.
</p><p>
Because this e-mail includes HTML text and or images, sound,
and so on, it is formatted using the MIME format. This type of e-mail includes
three extra headers:
</p>
</li>
</ul>
<blockquote>
<ol type="1">
<li class="row1">
MIME-Version</li>
<li class="row1">
Content-Type</li>
<li class="row1">
Content-Transfer-Encoding</li>
</ol>
</blockquote>
<ul class="slidesUl1">
<p>
The message body consists of plain text and HTML tags, images, links, and so on.
</p>
<h4>
Filename: mimemail.php
</h4>
<blockquote><small>
<div class="disp2">
<PRE>
<span class="syntax0"><span class="gutter">   1:</span><span class="syntax17">&lt;?php</span>
<span class="gutter">   2:</span>  <span class="syntax10">$Recipient</span> <span class="syntax18">=</span> <span class="syntax13">'</span><span class="syntax13">djefferson@gmail.com</span><span class="syntax13">'</span><span class="syntax18">;</span>
<span class="gutter">   3:</span>  <span class="syntax10">$MsgSubject</span> <span class="syntax18">=</span> <span class="syntax13">'</span><span class="syntax13">This</span><span class="syntax13"> </span><span class="syntax13">is</span><span class="syntax13"> </span><span class="syntax13">a</span><span class="syntax13"> </span><span class="syntax13">MIME</span><span class="syntax13"> </span><span class="syntax13">message</span><span class="syntax13"> </span><span class="syntax13">with</span><span class="syntax13"> </span><span class="syntax13">HTML</span><span class="syntax13"> </span><span class="syntax13">content</span><span class="syntax13">'</span><span class="syntax18">;</span>
<span class="gutter">   4:</span>
<span class="gutterH">   5:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">You</span><span class="syntax2"> </span><span class="syntax2">must</span><span class="syntax2"> </span><span class="syntax2">set</span><span class="syntax2"> </span><span class="syntax2">a</span><span class="syntax2"> </span><span class="syntax2">sender</span><span class="syntax2"> </span><span class="syntax2">through</span><span class="syntax2"> </span><span class="syntax2">message</span><span class="syntax2"> </span><span class="syntax2">header</span>
<span class="gutter">   6:</span>  <span class="syntax10">$MsgHeader</span> <span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">From</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">D</span><span class="syntax14">.</span><span class="syntax14">W</span><span class="syntax14">.</span><span class="syntax14"> </span><span class="syntax14">Jefferson</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">jefferson_dw</span><span class="syntax14">@</span><span class="syntax14">yahoo</span><span class="syntax14">.</span><span class="syntax14">com</span><span class="syntax14">&gt;</span><span class="syntax14">\r\n</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutter">   7:</span>
<span class="gutter">   8:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">These</span><span class="syntax2"> </span><span class="syntax2">two</span><span class="syntax2"> </span><span class="syntax2">lines</span><span class="syntax2"> </span><span class="syntax2">are</span><span class="syntax2"> </span><span class="syntax2">required</span>
<span class="gutter">   9:</span>  <span class="syntax10">$MsgHeader</span> <span class="syntax18">.</span><span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">MIME</span><span class="syntax14">-</span><span class="syntax14">Version</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">1</span><span class="syntax14">.</span><span class="syntax14">0\n</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutterH">  10:</span>  <span class="syntax10">$MsgHeader</span> <span class="syntax18">.</span><span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">Content</span><span class="syntax14">-</span><span class="syntax14">type</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">text</span><span class="syntax14">/</span><span class="syntax14">html</span><span class="syntax14">;</span><span class="syntax14"> </span><span class="syntax14">charset</span><span class="syntax14">=</span><span class="syntax14">us</span><span class="syntax14">-</span><span class="syntax14">ascii\n</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutter">  11:</span>
<span class="gutter">  12:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Message</span><span class="syntax2"> </span><span class="syntax2">body</span><span class="syntax2"> </span><span class="syntax2">is</span><span class="syntax2"> </span><span class="syntax2">HTML</span>
<span class="gutter">  13:</span>  <span class="syntax10">$MsgBody</span> <span class="syntax18">=</span> <span class="syntax14">&quot;</span>
<span class="gutter">  14:</span><span class="syntax14">&lt;</span><span class="syntax14">html</span><span class="syntax14">&gt;</span>
<span class="gutterH">  15:</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">head</span><span class="syntax14">&gt;</span>
<span class="gutter">  16:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">title</span><span class="syntax14">&gt;</span><span class="syntax14">HTML</span><span class="syntax14"> </span><span class="syntax14">message</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">title</span><span class="syntax14">&gt;</span>
<span class="gutter">  17:</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">head</span><span class="syntax14">&gt;</span>
<span class="gutter">  18:</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">body</span><span class="syntax14">&gt;</span>
<span class="gutter">  19:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">h2</span><span class="syntax14">&gt;</span><span class="syntax14">Congratulations</span><span class="syntax14">!</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">h2</span><span class="syntax14">&gt;</span>
<span class="gutterH">  20:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">p</span><span class="syntax14">&gt;</span><span class="syntax14">You</span><span class="syntax14"> </span><span class="syntax14">have</span><span class="syntax14"> </span><span class="syntax14">just</span><span class="syntax14"> </span><span class="syntax14">learned</span><span class="syntax14"> </span><span class="syntax14">how</span><span class="syntax14"> </span><span class="syntax14">to</span><span class="syntax14"> </span><span class="syntax14">send</span><span class="syntax14"> </span><span class="syntax14">an</span><span class="syntax14"> </span><span class="syntax14">HTML</span><span class="syntax14"> </span><span class="syntax14">message</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">p</span><span class="syntax14">&gt;</span>
<span class="gutter">  21:</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">body</span><span class="syntax14">&gt;</span>
<span class="gutter">  22:</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">html</span><span class="syntax14">&gt;</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutter">  23:</span>
<span class="gutter">  24:</span>  <span class="syntax10">$success</span> <span class="syntax18">=</span> <span class="syntax9">mail</span><span class="syntax18">(</span><span class="syntax10">$Recipient</span><span class="syntax18">,</span> <span class="syntax10">$MsgSubject</span><span class="syntax18">,</span> <span class="syntax10">$MsgBody</span><span class="syntax18">,</span> <span class="syntax10">$MsgHeader</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="gutterH">  25:</span>  <span class="syntax8">if</span><span class="syntax18"> (</span><span class="syntax10">$success</span><span class="syntax18">)</span>
<span class="gutter">  26:</span>    <span class="syntax8">echo</span> <span class="syntax13">'</span><span class="syntax13">Email</span><span class="syntax13"> </span><span class="syntax13">message</span><span class="syntax13"> </span><span class="syntax13">sent</span><span class="syntax13"> </span><span class="syntax13">to:</span><span class="syntax13"> </span><span class="syntax13">'</span><span class="syntax18">,</span> <span class="syntax10">$Recipient</span><span class="syntax18">;</span>
<span class="gutter">  27:</span>  <span class="syntax8">else</span>
<span class="gutter">  28:</span>    <span class="syntax8">echo</span> <span class="syntax13">'</span><span class="syntax13">Failed</span><span class="syntax13"> </span><span class="syntax13">to</span><span class="syntax13"> </span><span class="syntax13">send</span><span class="syntax13"> </span><span class="syntax13">email</span><span class="syntax13"> </span><span class="syntax13">message</span><span class="syntax13"> </span><span class="syntax13">to:</span><span class="syntax13"> </span><span class="syntax13">'</span><span class="syntax18">,</span> <span class="syntax10">$Recipient</span><span class="syntax18">;</span>
<span class="gutter">  29:</span><span class="syntax17">?&gt;</span></span>
</PRE>
</div>
</small></blockquote>
<p>
On line 6,the message header specifies who the message is coming from.
The format is specified by an Internet standard (RFC 822).
</p><p>
Line 9 adds some more header information. It specifies that the message is using MIME types.
</p><p>
Line 10 specifies that the MIME type of this e-mail is HTML and that the
encoding is in the U.S. ASCII standard. Lines 9 and 10 together specify that the
content of the message is HTML and should be rendered as such.
</p><p>
Your instructor will show you an email message received from a script like this
one. Notice that the content of the message is HTML this time and not just the plain text.
</p>
<li><p>
Sending a Message with an Attachment
</p><p>
An e-mail message sent with an attachment consists of different types of content,
called a multipart MIME message.
</p><p>
The message is divided into at least two parts, one for the message and one for
the attachment. To allow this type of e-mail to be sent, the MIME Content-Type
header must be specified as multipart/mixed to identify the different parts,
called chunks, of the e-mail message.
</p><p>
This allows the e-mail program to read the separate parts correctly.
Each part has its own type of content and will need its own headers to identify
that content.
</p><p>
The different parts are separated by a boundary parameter, a user-defined unique
word enclosed in two hyphens.
</p><p>
In the following example, an HTML message will be sent with an attachment included.
The content of the attachment is read from a file, and converted to an encoding
format that allows it to be transferred by the mail program.
</p><p>
The HTML message and the attachment text are divided into two parts and sent
as multipart/mixed content separated by a boundary and each containing its own
MIME headers.
</p>
<h4>
Filename: attachment.php
</h4>
<blockquote><small>
<div class="disp2">
<PRE>
<span class="syntax0"><span class="gutter">   1:</span><span class="syntax17">&lt;?php</span>
<span class="gutter">   2:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Read</span><span class="syntax2"> </span><span class="syntax2">in</span><span class="syntax2"> </span><span class="syntax2">file</span><span class="syntax2"> </span><span class="syntax2">content</span>
<span class="gutter">   3:</span>  <span class="syntax10">$FilePathName</span> <span class="syntax18">=</span> <span class="syntax13">'</span><span class="syntax13">Helios.jpg</span><span class="syntax13">'</span><span class="syntax18">;</span> <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">full</span><span class="syntax2"> </span><span class="syntax2">path</span><span class="syntax2"> </span><span class="syntax2">to</span><span class="syntax2"> </span><span class="syntax2">file</span>
<span class="gutter">   4:</span>  <span class="syntax10">$FileName</span> <span class="syntax18">=</span> <span class="syntax13">'</span><span class="syntax13">Helios.jpg</span><span class="syntax13">'</span><span class="syntax18">;</span> <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">just</span><span class="syntax2"> </span><span class="syntax2">file</span><span class="syntax2"> </span><span class="syntax2">name</span>
<span class="gutterH">   5:</span>  <span class="syntax10">$FileHandle</span> <span class="syntax18">=</span> <span class="syntax9">fopen</span><span class="syntax18">(</span><span class="syntax10">$FilePathName</span><span class="syntax18">,</span><span class="syntax13">'</span><span class="syntax13">rb</span><span class="syntax13">'</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="gutter">   6:</span>  <span class="syntax10">$FileContent</span> <span class="syntax18">=</span> <span class="syntax9">fread</span><span class="syntax18">(</span><span class="syntax10">$FileHandle</span><span class="syntax18">,</span> <span class="syntax9">filesize</span><span class="syntax18">(</span><span class="syntax10">$FilePathName</span><span class="syntax18">)</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="gutter">   7:</span>  <span class="syntax9">fclose</span><span class="syntax18">(</span><span class="syntax10">$FileHandle</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="gutter">   8:</span>
<span class="gutter">   9:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Encode</span><span class="syntax2"> </span><span class="syntax2">file</span><span class="syntax2"> </span><span class="syntax2">content</span>
<span class="gutterH">  10:</span>  <span class="syntax10">$AttachmentData</span> <span class="syntax18">=</span> <span class="syntax9">chunk_split</span><span class="syntax18">(</span><span class="syntax9">base64_encode</span><span class="syntax18">(</span><span class="syntax10">$FileContent</span><span class="syntax18">)</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="gutter">  11:</span>
<span class="gutter">  12:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Message</span><span class="syntax2"> </span><span class="syntax2">text</span>
<span class="gutter">  13:</span>  <span class="syntax10">$MsgHTMLPart</span> <span class="syntax18">=</span> <span class="syntax14">&quot;</span>
<span class="gutter">  14:</span><span class="syntax14">&lt;</span><span class="syntax14">html</span><span class="syntax14">&gt;</span>
<span class="gutterH">  15:</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">head</span><span class="syntax14">&gt;</span>
<span class="gutter">  16:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">title</span><span class="syntax14">&gt;</span><span class="syntax14">HTML</span><span class="syntax14"> </span><span class="syntax14">message</span><span class="syntax14"> </span><span class="syntax14">with</span><span class="syntax14"> </span><span class="syntax14">attachment</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">title</span><span class="syntax14">&gt;</span>
<span class="gutter">  17:</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">head</span><span class="syntax14">&gt;</span>
<span class="gutter">  18:</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">body</span><span class="syntax14">&gt;</span>
<span class="gutter">  19:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">h2</span><span class="syntax14">&gt;</span><span class="syntax14">Congratulations</span><span class="syntax14">!</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">h2</span><span class="syntax14">&gt;</span>
<span class="gutterH">  20:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">p</span><span class="syntax14">&gt;</span><span class="syntax14">You</span><span class="syntax14"> </span><span class="syntax14">have</span><span class="syntax14"> </span><span class="syntax14">just</span><span class="syntax14"> </span><span class="syntax14">learned</span><span class="syntax14"> </span><span class="syntax14">how</span><span class="syntax14"> </span><span class="syntax14">to</span><span class="syntax14"> </span><span class="syntax14">send</span><span class="syntax14"> </span><span class="syntax14">an</span><span class="syntax14"> </span><span class="syntax14">HTML</span><span class="syntax14"> </span><span class="syntax14">message</span>
<span class="gutter">  21:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">with</span><span class="syntax14"> </span><span class="syntax14">attachment</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">p</span><span class="syntax14">&gt;</span>
<span class="gutter">  22:</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">body</span><span class="syntax14">&gt;</span>
<span class="gutter">  23:</span><span class="syntax14">&lt;</span><span class="syntax14">/</span><span class="syntax14">html</span><span class="syntax14">&gt;</span>
<span class="gutter">  24:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutterH">  25:</span>
<span class="gutter">  26:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Forming</span><span class="syntax2"> </span><span class="syntax2">message</span>
<span class="gutter">  27:</span>  <span class="syntax10">$Recipient</span> <span class="syntax18">=</span> <span class="syntax13">'</span><span class="syntax13">djefferson@gmail.com</span><span class="syntax13">'</span><span class="syntax18">;</span>
<span class="gutter">  28:</span>  <span class="syntax10">$MsgSubject</span> <span class="syntax18">=</span> <span class="syntax13">'</span><span class="syntax13">NASA</span><span class="syntax13"> </span><span class="syntax13">Helios</span><span class="syntax13"> </span><span class="syntax13">experimental</span><span class="syntax13"> </span><span class="syntax13">aircraft</span><span class="syntax13">'</span><span class="syntax18">;</span>
<span class="gutter">  29:</span>
<span class="gutterH">  30:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">You</span><span class="syntax2"> </span><span class="syntax2">must</span><span class="syntax2"> </span><span class="syntax2">set</span><span class="syntax2"> </span><span class="syntax2">sender</span><span class="syntax2"> </span><span class="syntax2">through</span><span class="syntax2"> </span><span class="syntax2">message</span><span class="syntax2"> </span><span class="syntax2">header</span>
<span class="gutter">  31:</span>  <span class="syntax10">$MsgHeader</span> <span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">From</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">D</span><span class="syntax14">.</span><span class="syntax14">W</span><span class="syntax14">.</span><span class="syntax14"> </span><span class="syntax14">Jefferson</span><span class="syntax14"> </span><span class="syntax14">&lt;</span><span class="syntax14">jefferson_dw</span><span class="syntax14">@</span><span class="syntax14">yahoo</span><span class="syntax14">.</span><span class="syntax14">com</span><span class="syntax14">&gt;</span><span class="syntax14">\n</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutter">  32:</span>
<span class="gutter">  33:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">These</span><span class="syntax2"> </span><span class="syntax2">two</span><span class="syntax2"> </span><span class="syntax2">lines</span><span class="syntax2"> </span><span class="syntax2">mark</span><span class="syntax2"> </span><span class="syntax2">message</span><span class="syntax2"> </span><span class="syntax2">as</span><span class="syntax2"> </span><span class="syntax2">multipart</span>
<span class="gutter">  34:</span>  <span class="syntax10">$MsgHeader</span> <span class="syntax18">.</span><span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">MIME</span><span class="syntax14">-</span><span class="syntax14">Version</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">1</span><span class="syntax14">.</span><span class="syntax14">0\n</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutterH">  35:</span>  <span class="syntax10">$MsgHeader</span> <span class="syntax18">.</span><span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">Content</span><span class="syntax14">-</span><span class="syntax14">Type</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">multipart</span><span class="syntax14">/</span><span class="syntax14">mixed</span><span class="syntax14">;</span><span class="syntax14"> </span><span class="syntax14">boundary</span><span class="syntax14">=</span><span class="syntax14">\&quot;</span>
<span class="gutter">  36:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">-</span><span class="syntax14">-</span><span class="syntax14">NSD35F65YGsgrg3</span><span class="syntax14">-</span><span class="syntax14">-</span><span class="syntax14">\&quot;</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutter">  37:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">First</span><span class="syntax2"> </span><span class="syntax2">part</span><span class="syntax2"> </span><span class="syntax2">begins</span>
<span class="gutter">  38:</span>  <span class="syntax10">$MsgBody</span> <span class="syntax18">=</span> <span class="syntax14">&quot;</span>
<span class="gutter">  39:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">-</span><span class="syntax14">-</span><span class="syntax14">NSD35F65YGsgrg3</span><span class="syntax14">-</span><span class="syntax14">-</span>
<span class="gutterH">  40:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">Content</span><span class="syntax14">-</span><span class="syntax14">Type</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">text</span><span class="syntax14">/</span><span class="syntax14">html</span><span class="syntax14">;</span><span class="syntax14"> </span><span class="syntax14">charset</span><span class="syntax14">=</span><span class="syntax14">us</span><span class="syntax14">-</span><span class="syntax14">ascii</span>
<span class="gutter">  41:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">Content</span><span class="syntax14">-</span><span class="syntax14">Transfer</span><span class="syntax14">-</span><span class="syntax14">Encoding</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">8bit\n</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutter">  42:</span>
<span class="gutter">  43:</span>  <span class="syntax10">$MsgBody</span> <span class="syntax18">.</span><span class="syntax18">=</span> <span class="syntax10">$MsgHTMLPart</span><span class="syntax18">;</span>
<span class="gutter">  44:</span>
<span class="gutterH">  45:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Second</span><span class="syntax2"> </span><span class="syntax2">part</span><span class="syntax2"> </span><span class="syntax2">begins</span>
<span class="gutter">  46:</span>  <span class="syntax10">$MsgBody</span> <span class="syntax18">.</span><span class="syntax18">=</span> <span class="syntax14">&quot;</span>
<span class="gutter">  47:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">-</span><span class="syntax14">-</span><span class="syntax14">NSD35F65YGsgrg3</span><span class="syntax14">-</span><span class="syntax14">-</span>
<span class="gutter">  48:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">Content</span><span class="syntax14">-</span><span class="syntax14">Type</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">application</span><span class="syntax14">/</span><span class="syntax14">octet</span><span class="syntax14">-</span><span class="syntax14">stream</span><span class="syntax14">;</span><span class="syntax14"> </span><span class="syntax14">name</span><span class="syntax14">=</span><span class="syntax14">\&quot;</span><span class="syntax14">&quot;</span><span class="syntax18">.</span> <span class="syntax10">$FileName</span> <span class="syntax18">.</span><span class="syntax14">&quot;</span><span class="syntax14">\&quot;</span>
<span class="gutter">  49:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">Content</span><span class="syntax14">-</span><span class="syntax14">Transfer</span><span class="syntax14">-</span><span class="syntax14">Encoding</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">base64</span>
<span class="gutterH">  50:</span><span class="syntax14"> </span><span class="syntax14"> </span><span class="syntax14">Content</span><span class="syntax14">-</span><span class="syntax14">Disposition</span><span class="syntax14">:</span><span class="syntax14"> </span><span class="syntax14">attachment</span><span class="syntax14">;</span><span class="syntax14"> </span><span class="syntax14">filename</span><span class="syntax14">=</span><span class="syntax14">\&quot;</span><span class="syntax14">&quot;</span><span class="syntax18">.</span> <span class="syntax10">$FileName</span>
<span class="gutter">  51:</span>        <span class="syntax18">.</span><span class="syntax14">&quot;</span><span class="syntax14">\&quot;\n\n</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutter">  52:</span>
<span class="gutter">  53:</span>  <span class="syntax10">$MsgBody</span> <span class="syntax18">.</span><span class="syntax18">=</span> <span class="syntax10">$AttachmentData</span><span class="syntax18">;</span>
<span class="gutter">  54:</span>
<span class="gutterH">  55:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Message</span><span class="syntax2"> </span><span class="syntax2">ends</span>
<span class="gutter">  56:</span>  <span class="syntax10">$MsgBody</span> <span class="syntax18">.</span><span class="syntax18">=</span> <span class="syntax14">&quot;</span><span class="syntax14">\n</span><span class="syntax14">-</span><span class="syntax14">-</span><span class="syntax14">NSD35F65YGsgrg3</span><span class="syntax14">-</span><span class="syntax14">-</span><span class="syntax14">\n</span><span class="syntax14">&quot;</span><span class="syntax18">;</span>
<span class="gutter">  57:</span>
<span class="gutter">  58:</span>  <span class="syntax2">//</span><span class="syntax2"> </span><span class="syntax2">Sending</span><span class="syntax2"> </span><span class="syntax2">message</span>
<span class="gutter">  59:</span>  <span class="syntax10">$success</span> <span class="syntax18">=</span> <span class="syntax9">mail</span><span class="syntax18">(</span><span class="syntax10">$Recipient</span><span class="syntax18">,</span> <span class="syntax10">$MsgSubject</span><span class="syntax18">,</span> <span class="syntax10">$MsgBody</span><span class="syntax18">,</span> <span class="syntax10">$MsgHeader</span><span class="syntax18">)</span><span class="syntax18">;</span>
<span class="gutterH">  60:</span>  <span class="syntax8">if</span><span class="syntax18"> (</span><span class="syntax10">$success</span><span class="syntax18">)</span>
<span class="gutter">  61:</span>    <span class="syntax8">echo</span> <span class="syntax13">'</span><span class="syntax13">Message/Attachment</span><span class="syntax13"> </span><span class="syntax13">sent</span><span class="syntax13"> </span><span class="syntax13">to:</span><span class="syntax13"> </span><span class="syntax13">'</span><span class="syntax18">,</span> <span class="syntax10">$Recipient</span><span class="syntax18">;</span>
<span class="gutter">  62:</span>  <span class="syntax8">else</span>
<span class="gutter">  63:</span>    <span class="syntax8">echo</span> <span class="syntax13">'</span><span class="syntax13">Failed</span><span class="syntax13"> </span><span class="syntax13">to</span><span class="syntax13"> </span><span class="syntax13">send</span><span class="syntax13"> </span><span class="syntax13">message/attachment</span><span class="syntax13"> </span><span class="syntax13">to:</span><span class="syntax13"> </span><span class="syntax13">'</span><span class="syntax18">,</span> <span class="syntax10">$Recipient</span><span class="syntax18">;</span>
<span class="gutter">  64:</span><span class="syntax17">?&gt;</span></span>
</PRE>
</div>
</small></blockquote>
<p>
Line 3 defines the full path to the file on the local file system that will be
sent as an e-mail attachment.
</p><p>
You can open the file from the local file system or upload it, but in either
case the file is read and later encoded for e-mail transfer.
</p><p>
On line 4, the name of the file that will be attached is recorded.
It is an image file.
</p><p>
On line 5, the fopen() function, returns a handle to the file and opens it for
reading in binary mode.
</p><p>
On line 6, the fread() function reads in the content of the image file and
stores it in a variable.
</p><p>
On line 10, after converting the file to base64_encoded text
(to match the RFC 2045 formatting standard),
the file data is split into smaller chunks.
</p><p>
The <b>chunk_split()</b> function inserts end (defaults to \r\n) every 76
characters. It returns the new string, leaving the original string untouched.
</p><p>
The e-mail message is created on lines 13-24.
</p><p>
Lines 34-35 specify that this message will be using MIME data encoding and
has multiple parts. One part will be the message itself, and the other will be
the attachment.
</p><p>
The required boundary used to separate the two parts of the e-mail is specified
as: --NSD35F65YGsgrg3--. Two dashes are required on either side of the boundary.
</p><p>
The e-mail reader uses this boundary to determine what part of the message is
the attachment and what part is plain text.
</p><p>
We are assembling a valid multipart message one part at a time in the variable
$MsgBody.
</p><p>
The attachment file is of content type application/octet-stream, a binary file,
that cannot be viewed in a text-based client, such as an image, spreadsheet,
or Microsoft Word document. The name of the file is also specified.
</p><p>
The e-mail sent by this script will be shown to you in an email client by your
instructor. Notice the attachment to this e-mail.
</p><p>
Some e-mail programs might display the attachment directly in the message.
This depends on the configuration of the user's e-mail program.
</p>
</li>
</ul>
</div>
</body>
</html>
