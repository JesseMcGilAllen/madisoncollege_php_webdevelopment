<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<title>MySQL Privileges</title>
<link href="../../../css/basic.css" rel="stylesheet" type="text/css">
<script type="text/javascript" language="JavaScript">
<!--
function putSemester() {
    var today=new Date();
    var thisMonth=today.getMonth()+1;
    var thisYear=today.getFullYear();
    if(thisMonth <=6) {
        return "Spring, " + thisYear;
    }
    else {
       return "Fall, " + thisYear;
    }
}//-->
</script>
<style type="text/css">
<!--
    .bgStripes {
        background-image:url(../../../images/Xstripes.gif);
        background-attachment: fixed;
    }
    body {
        background-color:white;
    }
    strong {
        font-family: Arial, Helvetica, sans-serif;
    }
-->
</style>
</head>
<body style="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255);">
<table class="bgStripes" border="0" width="100%">
<tbody>
<tr name="firstRow">
<td valign="top" width="80"><span style="font-size: x-small; font-weight: bold;">
<script type="text/javascript">
<!--
    document.write(putSemester());
-->
</script>
</span> <br>
</td>
<td style="text-align: center;"><span style="font-weight: bold; font-size: medium; color: darkblue;">
PHP Web Development with MySQL
</span> </td>
<td align="right" valign="top" width="80"><span style="font-size: x-small; font-weight: bold;">
3 Credits</span> </td>
</tr>
<tr>
<td colspan="3" style="text-align: center;"><span style="font-size: xx-small; font-weight: bold;">
152-166</span> </td>
</tr>
</tbody>
</table>
<!--The heading for the slides --> <br>
<table class="headTable1" border="0">
<tbody>
<tr>
<td width="100"><a href="mysql1.html"><img alt="" src="../../../images/btn_lArrow.gif" border="0"></a><a href="index.html"><img alt="" src="../../../images/btn_upArrow.gif" border="0"></a><a href="index.html"><img alt="" src="../../../images/btn_rArrow.gif" border="0"></a></td>
<td>The MySQL Privilege System</td>
</tr>
</tbody>
</table>
<br>
<div class="disp1">
<ul class="slidesUl1">
<li><p>
With a drivers' license, "authentication" means verifying that it is really you
who owns the license by checking your picture and expiration date, and
"authorization" means validating what type of vehicle you are authorized to drive,
such as a car, a large truck, or a school bus.
</p><p>
Similarly, the primary purpose of the MySQL privilege system is to authenticate
that the user and password are valid to connect to the specified host,
as demonstrated in the previous examples in both the command-line and graphical
client.
</p><p>
The second purpose of the privilege system is to specify what the user, once
connected to the database, is authorized to do.
</p><p>
For example, some users might be authorized to only select and view the data
from a specific database, but not make any changes to it. Some might be able
to delete records, but not tables.
</p><p>
Once you have installed MySQL, it is time to understand some basic guidelines
of how to administer a MySQL database server, such as setting up the users
and the privileges they have on certain databases.
</p><p>
You can use either the mysql command-line tool or the mysqladmin tool for
performing administrative tasks.
</p><p>
Although there are some graphical administrative tools avaialable, we use
the command-line tools because they are always available and work the same
way regardless of your operating system whether it is Windows, Macintosh, or Linux.
</p><p>
The next section assumes you have basic SQL skills, such as familiarity with
INSERT, UPDATE, DELETE, and SELECT statements. If not, the SQL language is
summarized in Chapter 14 of the text.
</p></li>
<li><p>
Logging into the Database Server
</p><p>
When MySQL is installed, the mysql database is created with tables, called
grant tables that define the initial user accounts and privileges.
</p><p>
The first account is that of a user named "root," also called the superuser.
The superuser can do anything, meaning anyone logging onto the database as
root is granted all privileges.
</p><p>
Initially the root account has no password, making it easy for anyone to log
on as the superuser.
</p><p>
Another type of account that may be created is an anonymous user account,
having neither a user name nor a password!
</p><p>
To avoid security problems, you should remove the anonymous account, if it exists,
and set a password on the root account. We will discuss how to find out what user
accounts exist on your MySQL installation, and fix them, later in the course.
</p><p>
MySQL keeps track of its own users and passwords separate from the operating
system where it is running. All the privileges for the MySQL database server
are stored in the "mysql" database schema (the database with name "mysql").
</p><p>
For administration purposes, you should have root access rights to your server.
The <b>mysqladmin</b> utility is useful for creating passwords as well as
performing other MySQL administrative tasks. In the example below it is used to
set the password for the root user.
</p><p>
When working with MySQL, a number of like-name terms are used. The following
table is provided to help clarify the use of these terms.
</p><p>
Table: MySQL Terminology
</p>
<table>
<tr>
<td><code><b><u>
Term</u></b></code></td>
<td><code><b><u>
Description</u></b></code></td>
</tr><tr>
<td><code>
MySQL</code></td>
<td><code>
The actual software for the database management system</code></td>
</tr><tr>
<td><code>
mysqld</code></td>
<td><code>
The mySQL daemon or server process</code></td>
</tr><tr>
<td><code>
mysql monitor&nbsp;</code></td>
<td><code>
The monitor where MySQL commands are issued (command-line interpreter)</code></td>
</tr><tr>
<td><code>
mysql</code></td>
<td><code>
The name of the database MySQL uses to manage access privileges</code></td>
</tr><tr>
<td><code>
mysqladmin</code></td>
<td><code>
A MySQL utility program for administering the database</code></td>
</tr>
</table>
<p>
This example demonstrates how to set a password for root.
</p>
<blockquote><code><small>
$ mysqladmin -u root -h localhost password quigley1<br><br>
$ mysql -uroot -hlocalhost -pquigley1<br>
Welcome to the MySQL monitor.  Commands end with ; or \g.<br>
Your MySQL connection id is 29 to server version:<br>
5.0.21-community-nt<br><br>
Type 'help;' or '\h' for help. Type '\c' to clear the buffer.<br>
</small></code></blockquote>
<p>
The mysqladmin program is used to set a password for the root user on the localhost.
</p><p>
This mysql command logs the root user into the database server. The "-u" switch
is followed by the user or login name (a space between "-u" and the username
is optional).
</p><p>
This user is logging in as root. Similarly, the "-p" switch is followed by the
actual password, in this case "quigley1".
</p><p>
If a password is not provided on the command-line, you will be prompted to enter one.
</p></li>
<li><p>
Finding the Databases
</p><p>
The database server keeps a list of available databases that can be displayed
as a table by issuing the <b>show</b> command at the mysql prompt, as shown
below.
</p><p>
Typically when you install MySQL it comes with two databases: "test" and "mysql".
</p><p>
The "test" database is used for testing various features or creating sample databases.
You normally do not need to have any special permissions to be able to do anything
in that database.
</p><p>
The "mysql" database is a special database where the MySQL server stores
various access permissions. We look at the contents of the "mysql" database
in the next section.
</p>
<blockquote><code><small>
C:\>mysql -u root -p password<br>
Welcome to the MySQL monitor.  Commands end with ; or \g.<br>
Your MySQL connection id is 5 to server version: 4.1.11-nt<br><br>
Type 'help;' or '\h' for help. Type '\c' to clear the buffer.<br><br>
mysql> show databases;<br>
<pre>
+--------------+
| Database     |
+--------------+
| authority    |
| best         |
| jsf          |
| marakana_cms |
| mysql        |
| northwind    |
| test         |
+--------------+
7 rows in set (0.69 sec)
</pre>
mysql><br>
</small></code></blockquote>
<p>
The show databases command gives us the list of all the databases on this
server. Typically, when you install MySQL, you will be given the "mysql"
database and the "test" database.
</p><p>
The "test" database is just for testing purposes and is empty.
The "mysql" database contains all the MySQL server privilege information.
</p><p>
This example shows the tables in the mysql schema.
</p>
<blockquote><code><pre>
mysql> use mysql
Database changed
mysql> show tables;
+---------------------------+
| Tables_in_mysql           |
+---------------------------+
| columns_priv              |
| db                        |
| func                      |
| help_category             |
| help_keyword              |
| help_relation             |
| help_topic                |
| host                      |
| tables_priv               |
| time_zone                 |
| time_zone_leap_second     |
| time_zone_name            |
| time_zone_transition      |
| time_zone_transition_type |
| user                      |
+---------------------------+
15 rows in set (0.19 sec)
</pre></code></blockquote>
<p>
The "use mysql" command tells the server to switch to the "mysql" database
and make that the current database.
</p><p>
The show tables command displays all the database tables in the current
"mysql" database. This database contains 15 tables. The tables we are
concerned with now are "host," "user," and "db."
</p></li>
<li><p>
The "user" Table
</p><p>
The "user" table specifies the users who are allowed to log into the database
server and from what host. It also holds their passwords and global access
privileges.
</p><p>
Let's look at the fields of the "user" table:
</p>
<code><small><pre>
mysql> describe user;
+-----------------------+-----------------------------------+
| Field                 |  Type                             |
+-----------------------+-----------------------------------+
| Host                  | varchar(60)                       |
| User                  | varchar(16)                       |
| Password              | varchar(41)                       |
| Select_priv           | enum('N','Y')                     |
| Insert_priv           | enum('N','Y')                     |
| Update_priv           | enum('N','Y')                     |
| Delete_priv           | enum('N','Y')                     |
| Create_priv           | enum('N','Y')                     |
| Drop_priv             | enum('N','Y')                     |
| Reload_priv           | enum('N','Y')                     |
| Shutdown_priv         | enum('N','Y')                     |
| Process_priv          | enum('N','Y')                     |
| File_priv             | enum('N','Y')                     |
| Grant_priv            | enum('N','Y')                     |
| References_priv       | enum('N','Y')                     |
| Index_priv            | enum('N','Y')                     |
| Alter_priv            | enum('N','Y')                     |
| Show_db_priv          | enum('N','Y')                     |
| Super_priv            | enum('N','Y')                     |
| Create_tmp_table_priv | enum('N','Y')                     |
| Lock_tables_priv      | enum('N','Y')                     |
| Execute_priv          | enum('N','Y')                     |
| Repl_slave_priv       | enum('N','Y')                     |
| Repl_client_priv      | enum('N','Y')                     |
| ssl_type              | enum('','ANY','X509','SPECIFIED') |
| ssl_cipher            | blob                              |
| x509_issuer           | blob                              |
| x509_subject          | blob                              |
| max_questions         | int(11) unsigned                  |
| max_updates           | int(11) unsigned                  |
| max_connections       | int(11) unsigned                  |
+-----------------------+-----------------------------------+
31 rows in set (0.00 sec)
</pre></small></code>
<p>
The key fields are Host, User, and Password. All the other fields are used to
fine-tune the privileges. To log in, the user and password must match and the
user must be from the given host.
</p><p>
The password field should be encoded so that it is not easily readable by
someone looking over your shoulder. MySQL provides a function called
<b>password()</b> to do just that. We see how to use it in the next example.
</p></li>
<li><p>
The "db" Table
</p><p>
The "db" table determines which databases a user is permitted to read, edit,
and delete, limiting access to a certain host and user.
Its contents are described in the following query:
</p>
<blockquote><code><small><pre>
mysql> describe db;
+-----------------------+---------------+
| Field                 |  Type         |
+-----------------------+---------------+
| Host                  | char(60)      |
| Db                    | char(64)      |
| User                  | char(16)      |
| Select_priv           | enum('N','Y') |
| Insert_priv           | enum('N','Y') |
| Update_priv           | enum('N','Y') |
| Delete_priv           | enum('N','Y') |
| Create_priv           | enum('N','Y') |
| Drop_priv             | enum('N','Y') |
| Grant_priv            | enum('N','Y') |
| References_priv       | enum('N','Y') |
| Index_priv            | enum('N','Y') |
| Alter_priv            | enum('N','Y') |
| Create_tmp_table_priv | enum('N','Y') |
| Lock_tables_priv      | enum('N','Y') |
+-----------------------+---------------+
</pre></small></code></blockquote>
<p>
The key fields are the Host, Db, and User fields. The other fields are used
for fine-tuning the access rights.
</p><p>
The default value is always "No" for the privileges, meaning that access rights
must be explicitly granted. ('N' is no/false and 'Y' is yes/true.)
</p></li>
<li><p>
The "host" Table
</p><p>
The "host" table is an extension of the "db" table. If the "db" table does not
have a host entry. It contains the hosts (IP addresses), databases, and
privileges that can connect to the MySQL database server.
</p><p>
Often, your PHP script is running on the same host computer as your database
server. The host is called "localhost," which is simply an alias for the current
host machine located at IP address 127.0.0.1.
</p><p>
For example, if you are on the server <b>myserver.com</b> , you can refer to it
as the localhost. If later you change the name of the server to <b>yourhost.com</b> ,
your database connection will still be available because localhost always refers
to the current host computer.
</p><p>
The fields in the "host" table are shown in the following query:
</p>
<code><small><pre>
mysql> describe host;
+-----------------------+---------------+------+-----+---------+-------+
| Field                 | Type          | Null | Key | Default | Extra |
+-----------------------+---------------+------+-----+---------+-------+
| Host                  | char(60)      |      | PRI |         |       |
| Db                    | char(64)      |      | PRI |         |       |
| Select_priv           | enum('N','Y') |      |     | N       |       |
| Insert_priv           | enum('N','Y') |      |     | N       |       |
| Update_priv           | enum('N','Y') |      |     | N       |       |
| Delete_priv           | enum('N','Y') |      |     | N       |       |
| Create_priv           | enum('N','Y') |      |     | N       |       |
| Drop_priv             | enum('N','Y') |      |     | N       |       |
| Grant_priv            | enum('N','Y') |      |     | N       |       |
| References_priv       | enum('N','Y') |      |     | N       |       |
| Index_priv            | enum('N','Y') |      |     | N       |       |
| Alter_priv            | enum('N','Y') |      |     | N       |       |
| Create_tmp_table_priv | enum('N','Y') |      |     | N       |       |
| Lock_tables_priv      | enum('N','Y') |      |     | N       |       |
+-----------------------+---------------+------+-----+---------+-------+
14 rows in set (0.31 sec)
</pre></small></code>
<p>
The Db field contains all the users, databases, and hostnames for this MySQL
server. The other fields are switches with Yes/No options to grant or revoke
certain privileges and specify the level of that access right.
</p><p>
The following INSERT command grants access to the Northwind database from localhost.
</p>
<code><small><pre>
mysql> insert into host (host, db, Select_priv, Insert_priv,
    ->        Update_priv, Delete_priv, Create_priv, Drop_priv)
    ->        values ('localhost','northwind','Y','Y','Y','Y','Y','Y');
Query OK, 1 row affected (0.53 sec)
</pre></small></code>
<p>
The "insert into host" command grants Select/Insert/Update/Delete/Create/Drop
access to the <b>northwind</b> database from localhost, setting certain switches
to Y for yes. The ones that are not set will default to N for no.
</p></li>
<li><p>
A Real-World Example
</p><p>
The following steps set privileges so that user "bob" can log into a MySQL
database called "northwind" from the localhost using the password guess.
After entering the mysql database with the use mysql command, the steps are:
</p>
</li>
</ul>
<blockquote>
<ol type="1">
<li class="row1">
<p>
Create the host record:
</p>
<code><pre>
mysql> insert into host(host, db, Select_priv, Insert_priv,
    ->        Update_priv, Delete_priv, Create_priv, Drop_priv)
    ->        values ('localhost','northwind','Y','Y','Y','Y','Y','Y');
</pre></code>
</li>
<li class="row0">
<p>
Create the user:
</p>
<code><pre>
mysql> insert into user(host,user,password)
    ->        values('localhost','bob',password('guess'));
</pre></code>
</li>
<li class="row0">
<p>
Update the "db" table:
</p>
<code><pre>
mysql> insert into db
(host,db,user,Select_priv,Insert_priv,Update_priv,
    ->        Delete_priv,Create_priv,Drop_priv)
    ->        values
('localhost','northwind','bob','Y','Y','Y','Y','Y','Y');
</pre></code>
</li>
<li class="row0">
<p>
Issue the "flush privileges" command to make the changes take affect:
</p>
<code>
mysql> flush privileges;<br>
</code>
</li>
<li class="row0">
<p>
Finally, to test whether everything is set up properly, you can log out of the
mysql server and try to reconnect using the user "bob", password "guess",
and host "localhost" to the database <b>northwind</b> :
</p>
<code>
C:\>mysql -ubob -pguess -hlocalhost northwind<br>
Welcome to the MySQL monitor.  Commands end with ; or \g.<br>
Your MySQL connection id is 8 to server version: 4.1.11-nt<br><br>
Type 'help;' or '\h' for help. Type '\c' to clear the buffer.<br>
</code>
</li>
</ol>
</blockquote>
<ul class="slidesUl1">
<li>
<p>
The Grant and Revoke Commands
</p><p>
MySQL access control involves two stages when you try to connect to the mysql
server. First the server checks to see if you are allowed to connect,
and second, if you can connect, the server checks each statement you issue
to determine whether or not you have sufficient privileges to execute the command.
</p><p>
For example, if you try to create or drop a table in the database, or try to
update a record, the server verifies that you have the correct privileges to
execute those commands.
</p><p>
To simplify all the steps required to set up the privileges on a database or
a table, MySQL provides two commands: GRANT and REVOKE.
</p><p>
The best way to illustrate how to use them is to see the following examples.
</p>
<blockquote><code>
GRANT ALL ON *.*<br>
REVOKE ALL ON *.*<br>
</code></blockquote>
<p>
This GRANT command grants all the privileges to all databases on the current server.
</p><p>
This REVOKE command revokes all the privileges to all databases on the current server.
</p>
<blockquote><code>
GRANT ALL ON db_name.*<br>
REVOKE ALL ON db_name.*<br>
</code></blockquote>
<p>
This GRANT command grants all the privileges to all the tables in the database
<b>db_name</b>.
</p><p>
This REVOKE command revokes all the privileges to all the tables of the database
identified by <b>db_name</b> .
</p>
<blockquote><code>
GRANT ALL ON db_name.tbl_name<br>
REVOKE ALL ON db_name.tbl_name<br>
</code></blockquote>
<p>
This GRANT command grants all the privileges to a specific table "tbl_name"
in the database db_name.
</p><p>
This REVOKE command revokes the privileges on the table "tbl_name" in the
database db_name.
</p><p>
You can also specify the user for which you are granting or revoking the
privileges by adding the "TO 'user'@'host'" and "IDENTIFIED BY 'password'"
clauses to the statement.
</p>
<code><small>
GRANT ALL PRIVILEGES ON db_name.tbl_name TO 'bob'@'localhost'<br>
IDENTIFIED BY 'guess'<br>
</small></code>
<p>
This command will give user "bob" all the privileges when he logs in from
localhost and tries to access database db_name and table tbl_name.
</p></li>
<li><p>
Creating and Dropping a Database
</p><p>
Creating a database is simple. Designing it is another story and depends on
your requirements and the model you will use to organize your data.
</p><p>
With the smallest database, you will have to create at least one table.
Later in the course we discuss how to create and drop both databases and
tables.
</p><p>
Assuming you have been granted permission to create a database, you can do it
at the mysql command line or with the mysqladmin tool as illustrated below.
</p>
<blockquote><code><small><pre>
mysql> create database my_sample_db;
Query OK, 1 row affected (0.00 sec)

mysql> use my_sample_db;
Database changed

mysql> show tables;
Empty set (0.00 sec)

mysql> create table test(
    -> field1 INTEGER,
    -> field2 VARCHAR(50)
    -> );
Query OK, 0 rows affected (0.36 sec)

mysql> show tables;
+------------------------+
| Tables_in_my_sample_db |
+------------------------+
| test                   |
+------------------------+
1 row in set (0.00 sec)

mysql> drop table test;
Query OK, 0 rows affected (0.11 sec)

mysql> drop database my_sample_db;
Query OK, 0 rows affected (0.01 sec)
</pre></small></code></blockquote>
<p>
We use the "create database" statement to create a database called my_sample_db.
</p><p>
Just because the database has been created does not mean you are in it.
To enter the new database, the "use" command is executed.
</p><p>
The show command lists all the tables in the database.
</p><p>
To create a table, the table columns are defined with the data types for each
column. In this table the two columns "field1" and "field2" are defined.
</p><p>
The first field will be assigned integer values and the second field will be
assigned up to 50 characters.
</p><p>
After creating the table, the show command displays the fact that a table exists
in the database.
</p><p>
The drop table command destroys the table "test" and its contents.
</p><p>
The drop database command destroys the "my_sample_db" database and its contents.
</p></li>
<li><p>
Some Useful MySQL Functions
</p><p>
MySQL comes with a number of built-in functions that provide information about
the server, the user, connection, version, how to encrypt and encode strings,
display date and time, and so on. Examples follow the table.
</p><p>
Table: MySQL Functions
</p>
<table>
<tr>
<td><code><b><u>
Function</u></b></code></td>
<td><code><b><u>
What It Returns</u></b></code></td>
<td><code><b><u>
Example</u></b></code></td>
</tr><tr>
<td><code>
database()&nbsp;</code></td>
<td><code>
Name of the current database</code></td>
<td><code>
select database();</code></td>
</tr><tr>
<td><code>
version()</code></td>
<td><code>
Version of MySQL software</code></td>
<td><code>
select version();</code></td>
</tr><tr>
<td><code>
user()</code></td>
<td><code>
Name of current MySQL user</code></td>
<td><code>
select user();</code></td>
</tr><tr>
<td><code>
password()</code></td>
<td><code>
Encrypts a string passed as an argument&nbsp;</code></td>
<td><code>
select password("mypassword");</code></td>
</tr><tr>
<td><code>
now()</code></td>
<td><code>
The current date and time</code></td>
<td><code>
select now();</code></td>
</tr><tr>
<td><code>
curdate()</code></td>
<td><code>
The current year, month, day</code></td>
<td><code>
select curdate();</code></td>
</tr>
</table>
<p>
The following examples illustrate the usage of many of the MySQL built-in
functions.
</p>
<code><small><pre>
mysql> use northwind;
Database changed

mysql> select database();
+------------+
| database() |
+------------+
| northwind  |
+------------+
1 row in set (0.00 sec)

mysql> select version();
+---------------------+
| version()           |
+---------------------+
| 5.0.21-community-nt |
+---------------------+
1 row in set (0.00 sec)

mysql> select user();
+----------------+
| user()         |
+----------------+
| root@localhost |
+----------------+
1 row in set (0.00 sec)

mysql> set password for root@localhost = password('ellieq');
Query OK, 0 rows affected (0.03 sec)

mysql> select password("ellieq");
+-------------------------------------------+
| password("ellieq")                        |
+-------------------------------------------+
| *5313CC84288581F3B15B0ECBBFA2E9AF6AE4FD5A |
+-------------------------------------------+
1 row in set (0.00 sec)

mysql> select now();
+---------------------+
| now()               |
+---------------------+
| 2006-06-07 15:09:16 |
+---------------------+
1 row in set (0.02 sec)

mysql> select curdate();
+------------+
| curdate()  |
+------------+
| 2006-06-07 |
+------------+
1 row in set (0.00 sec)
</pre></small></code>
</li>
</ul>
</div>
</body>
</html>
